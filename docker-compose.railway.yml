# Docker Compose for local testing of Railway deployment
# This mimics the Railway environment locally
#
# Usage:
#   Option 1: Copy config/kimi.env to .env and edit, then:
#            docker-compose -f docker-compose.railway.yml up -d
#
#   Option 2: Set environment variables inline:
#            LLM_MODEL=kimi-k2-turbo-preview LLM_API_KEY=sk-... docker-compose -f docker-compose.railway.yml up -d

version: '3.8'

services:
  openhands:
    build:
      context: .
      dockerfile: Dockerfile.railway
    image: openhands:railway
    container_name: openhands-railway
    environment:
      # Server Configuration
      - PORT=3000
      
      # LLM Configuration - KIMI (Moonshot AI) Defaults
      # Get your API key from: https://platform.moonshot.cn
      - LLM_MODEL=${LLM_MODEL:-kimi-k2-turbo-preview}  # Options: kimi-k2-turbo-preview, kimi-k2, kimi-k1.5
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_BASE_URL=${LLM_BASE_URL:-https://api.moonshot.cn/v1}
      
      # Alternative Providers (uncomment and comment out above to switch):
      # OpenAI:
      # - LLM_MODEL=gpt-4o
      # - LLM_API_KEY=${OPENAI_API_KEY}
      # - LLM_BASE_URL=https://api.openai.com/v1
      
      # Anthropic Claude:
      # - LLM_MODEL=claude-3-5-sonnet-20241022
      # - LLM_API_KEY=${ANTHROPIC_API_KEY}
      # - LLM_BASE_URL=${ANTHROPIC_BASE_URL}
      
      # DeepSeek:
      # - LLM_MODEL=deepseek-chat
      # - LLM_API_KEY=${DEEPSEEK_API_KEY}
      # - LLM_BASE_URL=https://api.deepseek.com/v1
      
      # Agent Configuration
      - SANDBOX_TYPE=local
      - USE_HOST_NETWORK=false
      - AGENT_MEMORY_ENABLED=${AGENT_MEMORY_ENABLED:-true}
      - MAX_ITERATIONS=${MAX_ITERATIONS:-100}
      - DEBUG=${DEBUG:-false}
      
      # Storage Paths
      - WORKSPACE_BASE=/opt/workspace_base
      - FILE_STORE_PATH=/.openhands
    ports:
      - "3000:3000"
    volumes:
      - openhands-workspace:/opt/workspace_base
      - openhands-data:/.openhands
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  openhands-workspace:
    driver: local
  openhands-data:
    driver: local
